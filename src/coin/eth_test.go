package coin

import (
	"fmt"
	"testing"
)

func TestETHCalcAddressByPubkey(t *testing.T) {
	pubKeyStr := "18f2fdf00b27416fedcd8044b0a4732f1c7e7f508b8754a29a2eff17a4187dada6951c543fcbd55840c99e29c3f34e95923e481d38d7c6b456e35bf285a7cd4e"

	addrStr, _ := ETHCalcAddressByPubkey(pubKeyStr)
	fmt.Println(addrStr)
}

func TestETHAgent_CreateTransaction(t *testing.T) {
	ttt := ETHAgent{}
	ttt.CreateTransaction("ETH", "", "", "11111", "222222", "222223", "", 8)
}

func TestETHAgent_CreateTransaction2(t *testing.T) {
	ttt := ETHAgent{}
	ttt.Init("http://192.168.1.164:28000")
	pubkey_str := "18f2fdf00b27416fedcd8044b0a4732f1c7e7f508b8754a29a2eff17a4187dada6951c543fcbd55840c99e29c3f34e95923e481d38d7c6b456e35bf285a7cd4e"
	from_addr, err := ETHCalcAddressByPubkey(pubkey_str)
	if err != nil {
		fmt.Println("err:", err.Error())
		return
	}
	fmt.Println(from_addr)

	byte_datas, err := ttt.CreateTransaction("ETH", from_addr, "0xDB3884C583eB79F72B340F0968FCf8Bee9bd241A", "21000", "2100000000", "1", "", 8)
	if err != nil {
		fmt.Println("err1:", err.Error())
		return
	}
	fmt.Println(byte_datas)

}

func TestETHAgent_GetTransactionRealCost(t *testing.T) {
	ttt := ETHAgent{}
	ttt.Init("http://192.168.1.164:28000")

	byte_datas, err := ttt.GetTransactionRealCost("ETH", "0x251714320f339789cb899c66c2284494c58c164c8c29e293dd14ce6107b36181")
	if err != nil {
		fmt.Println("err1:", err.Error())
		return
	}
	fmt.Println(byte_datas)
}

func TestConvertStringToBigNumber(t *testing.T) {
	fmt.Println(ConvertStringToBigNumber("ETH", "1"))
	fmt.Println(ConvertStringToBigNumber("ETH", "1.1"))
	fmt.Println(ConvertStringToBigNumber("ETH", "1.00000001"))
	fmt.Println(ConvertStringToBigNumber("ETH", "1000000.00000001"))
}

func TestETHAgent_EstimateGas(t *testing.T) {
	ttt := ETHAgent{}
	ttt.Init("http://192.168.1.164:28000")
	fees, err := ttt.EstimateGas("0xe51eb7fdaf16b9bbbb48d5f1dc56aac53e4f9fad", "", "0x608060405234801561001057600080fd5b506040516116073803806116078339810180604052810190808051820192919060200180519060200190929190505050818160008251821180610054575060fa8351115b1561005e57610116565b8251600181905550600090505b825181101561010e57828181518110151561008257fe5b9060200190602002015173ffffffffffffffffffffffffffffffffffffffff16600260018301610100811015156100b557fe5b018190555060018101610102600085848151811015156100d157fe5b9060200190602002015173ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600101905061006b565b816000819055505b50505050506114dd8061012a6000396000f3006080604052600436106100c5576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806307a090cd1461013c578063083c5eba146101a85780631398a5f6146101f15780634123cb6b1461021c578063627a741914610247578063746c9171146102cd578063797af627146102f8578063a0e67e2b14610341578063b61d27f6146103ad578063b75c7dc61461042a578063c2cf73261461045b578063c41a360a146104c4578063ef18374a14610531575b600034111561013a577fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c3334604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a15b005b34801561014857600080fd5b5061015161055c565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b83811015610194578082015181840152602081019050610179565b505050509050019250505060405180910390f35b3480156101b457600080fd5b506101d76004803603810190808035600019169060200190929190505050610685565b604051808215151515815260200191505060405180910390f35b3480156101fd57600080fd5b506102066106c7565b6040518082815260200191505060405180910390f35b34801561022857600080fd5b506102316106d0565b6040518082815260200191505060405180910390f35b34801561025357600080fd5b5061027660048036038101908080356000191690602001909291905050506106d6565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156102b957808201518184015260208101905061029e565b505050509050019250505060405180910390f35b3480156102d957600080fd5b506102e2610817565b6040518082815260200191505060405180910390f35b34801561030457600080fd5b50610327600480360381019080803560001916906020019092919050505061081d565b604051808215151515815260200191505060405180910390f35b34801561034d57600080fd5b50610356610831565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561039957808201518184015260208101905061037e565b505050509050019250505060405180910390f35b3480156103b957600080fd5b50610410600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291908035906020019082018035906020019190919293919293905050506108eb565b604051808215151515815260200191505060405180910390f35b34801561043657600080fd5b506104596004803603810190808035600019169060200190929190505050610b7a565b005b34801561046757600080fd5b506104aa6004803603810190808035600019169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610c8e565b604051808215151515815260200191505060405180910390f35b3480156104d057600080fd5b506104ef60048036038101908080359060200190929190505050610d0e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561053d57600080fd5b50610546610d2c565b6040518082815260200191505060405180910390f35b6060600080600060606101048054905093506000925060009150600091505b838210156105bd5760006101048381548110151561059557fe5b9060005260206000200154600190041415156105b2576001830192505b81600101915061057b565b826040519080825280602002602001820160405280156105ec5781602001602082028038833980820191505090505b50905060009250600091505b8382101561067b5760006101048381548110151561061257fe5b906000526020600020015460019004141515610670576101048281548110151561063857fe5b9060005260206000200154818481518110151561065157fe5b9060200190602002019060001916908160001916815250506001830192505b8160010191506105f8565b8094505050505090565b6000806101036000846000191660001916815260200190815260200160002090506000816000015414156106bc57600191506106c1565b600091505b50919050565b60008054905090565b60015481565b60606000806000806060610103600088600019166000191681526020019081526020016000209450600093506000925060009150600193505b60fa84111515610741578360020a9250600083866001015416141515610736576001820191505b83600101935061070f565b816040519080825280602002602001820160405280156107705781602001602082028038833980820191505090505b50905060009150600193505b60fa8411151561080a578360020a92506000838660010154161415156107ff57600284610100811015156107ac57fe5b015481838151811015156107bc57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250506001820191505b83600101935061077c565b8095505050505050919050565b60005481565b600061082a826000610d36565b9050919050565b60608060006001546040519080825280602002602001820160405280156108675781602001602082028038833980820191505090505b509150600090505b6001548110156108e3576002600182016101008110151561088c57fe5b0154828281518110151561089c57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505080600101905061086f565b819250505090565b6000806108f73361111a565b151561090257600080fd5b858560003643604051808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c010000000000000000000000000281526014018581526020018484808284378201915050828152602001955050505050506040518091039020905060006101056000836000191660001916815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610a8957856101056000836000191660001916815260200190815260200160002060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508461010560008360001916600019168152602001908152602001600020600101819055508383610105600084600019166000191681526020019081526020016000206002019190610a83929190611373565b50610a92565b60009150610b71565b7f1733cbb53659d713b79580f79f3f9ff215f78a7c7aa45890f3b89fc5cddfbf328133878988886040518087600019166000191681526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018581526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252848482818152602001925080828437820191505097505050505050505060405180910390a1610b6e816001610d36565b91505b50949350505050565b600080600061010260003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205492506000831415610bba57610c88565b8260020a91506101036000856000191660001916815260200190815260200160002090506000828260010154161115610c875780600001600081548092919060010191905055508181600101600082825403925050819055507fc7fb647e59b18047309aa15aad418e5d7ca96d173ad704f1031a2c3d7591734b3385604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182600019166000191681526020019250505060405180910390a15b5b50505050565b60008060008061010360008760001916600019168152602001908152602001600020925061010260008673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205491506000821415610cf15760009350610d05565b8160020a9050600081846001015416141593505b50505092915050565b600060026001830161010081101515610d2357fe5b01549050919050565b6000600154905090565b60008282610d448282611150565b1515610d4f57600080fd5b60006101056000876000191660001916815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614158015610dd557506000610103600087600019166000191681526020019081526020016000206000015411155b15611111576101056000866000191660001916815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166101056000876000191660001916815260200190815260200160002060010154610105600088600019166000191681526020019081526020016000206002016040518082805460018160011615610100020316600290048015610ed45780601f10610ea957610100808354040283529160200191610ed4565b820191906000526020600020905b815481529060010190602001808311610eb757829003601f168201915b505091505060006040518083038185875af1925050501515610ef557600080fd5b7fe7c957c06e9a662c1a6c77366179f5b702b97651dc28eee7d5bf1dff6e40bb4a3386610105600089600019166000191681526020019081526020016000206001015461010560008a6000191660001916815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661010560008b60001916600019168152602001908152602001600020600201604051808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200185600019166000191681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001806020018281038252838181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156110985780601f1061106d57610100808354040283529160200191611098565b820191906000526020600020905b81548152906001019060200180831161107b57829003601f168201915b5050965050505050505060405180910390a161010560008660001916600019168152602001908152602001600020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600182016000905560028201600061110691906113f3565b505060019250611112565b5b505092915050565b60008061010260008473ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054119050919050565b60008060008061010260003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205492506000831415611195576000935061136a565b61010360008760001916600019168152602001908152602001600020915060008260000154141561122a578415156111d0576000935061136a565b60005482600001819055506000826001018190555061010480548091906001016111fa919061143b565b826002018190555085610104836002015481548110151561121757fe5b9060005260206000200181600019169055505b8260020a90506000818360010154161415611365577fe1c52dc63b719ade82e8bea94cc41a0d5d28e4aaf536adb5e9cccc9ff8c1aeda3387604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182600019166000191681526020019250505060405180910390a18160000160008154809291906001900391905055508082600101600082825417925050819055506000826000015411151561135c57610104610103600088600019166000191681526020019081526020016000206002015481548110151561131657fe5b9060005260206000200160009055610103600087600019166000191681526020019081526020016000206000808201600090556001820160009055600282016000905550505b6001935061136a565b600093505b50505092915050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106113b457803560ff19168380011785556113e2565b828001600101855582156113e2579182015b828111156113e15782358255916020019190600101906113c6565b5b5090506113ef9190611467565b5090565b50805460018160011615610100020316600290046000825580601f106114195750611438565b601f0160209004906000526020600020908101906114379190611467565b5b50565b81548183558181111561146257818360005260206000209182019101611461919061148c565b5b505050565b61148991905b8082111561148557600081600090555060010161146d565b5090565b90565b6114ae91905b808211156114aa576000816000905550600101611492565b5090565b905600a165627a7a723058209ee54ae395fd2fbf200546e18864f16959d69ccb90eade920872fd3ee0fd290b0029")
	if err != nil {
		fmt.Println(err.Error())
	}
	fmt.Println(fees.Uint64())
}
